<!doctype html>
<html lang="sr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Najbolje iz Vojvodine ‚Äì mapa (full screen)</title>
  <link href="https://unpkg.com/maplibre-gl@3.6.1/dist/maplibre-gl.css" rel="stylesheet" />
  <style>
    :root { --bg:#0b1220; --shadow:0 10px 25px rgba(0,0,0,.25); }
    html,body {height:100%; margin:0; background:var(--bg);}
    #map {position:fixed; inset:0}
    .toolbar {
      position: fixed; left: 12px; top: 12px; z-index: 10;
      background: rgba(17,24,39,.85); color:#e5e7eb;
      border: 1px solid rgba(255,255,255,.08); border-radius: 12px;
      padding: .55rem .7rem; font: 13px system-ui; box-shadow: var(--shadow);
      display:flex; align-items:center; gap:.6rem;
    }
    .toolbar a { color:#93c5fd; text-decoration:none; border-bottom:1px dashed rgba(147,197,253,.5); }
    .toolbar a:hover { border-bottom-color:transparent; }
  </style>
</head>
<body>
<div id="map"></div>
<div class="toolbar">
  <span>Najbolje iz Vojvodine ‚Äì demo</span>
  <a id="share" href="#" title="Copy share link">Kopiraj link</a>
</div>

<script src="https://unpkg.com/maplibre-gl@3.6.1/dist/maplibre-gl.js"></script>
<script>
  function qp() { const u=new URL(location.href); return Object.fromEntries(u.searchParams.entries()); }
  const p = qp();
  const center = [ +(p.lng||19.8335), +(p.lat||45.2671) ];
  const zoom   = +(p.zoom||7);

  const style = {
    "version": 8,
    "glyphs": "https://demotiles.maplibre.org/font/{fontstack}/{range}.pbf",
    "sources": { "osm": { "type": "raster", "tiles": ["https://tile.openstreetmap.org/{z}/{x}/{y}.png"], "tileSize": 256, "attribution": "¬© OpenStreetMap contributors" } },
    "layers": [ { "id":"osm", "type":"raster", "source":"osm" } ]
  };

  const map = new maplibregl.Map({ container:'map', style, center, zoom });
  map.addControl(new maplibregl.NavigationControl(), 'top-right');

  const data = {
    "type":"FeatureCollection",
    "features":[
      { "type":"Feature", "properties":{"naziv":"Vinarija Primer","kategorija":"Vina","opis":"Porodiƒçna vinarija na obroncima Fru≈°ke gore.","web":"https://primer-vinarija.rs","foto":"https://picsum.photos/seed/vino/800/440"}, "geometry":{"type":"Point","coordinates":[19.715,45.144]} },
      { "type":"Feature", "properties":{"naziv":"Sala≈° Primer","kategorija":"Gastronomija","opis":"Autentiƒçna vojvoƒëanska kuhinja.","web":"https://salas-primer.rs","foto":"https://picsum.photos/seed/salas/800/440"}, "geometry":{"type":"Point","coordinates":[19.12,45.26]} },
      { "type":"Feature", "properties":{"naziv":"Med iz Ravnice","kategorija":"Proizvodi","opis":"Pƒçelarska domaƒáinstva sa sertifikatom kvaliteta.","web":"https://med-ravnica.rs","foto":"https://picsum.photos/seed/med/800/440"}, "geometry":{"type":"Point","coordinates":[20.05,45.49]} }
    ]
  };

  const CAT = {
    "Vina":         { emoji:"üç∑", color:"#3b1d2a" },
    "Gastronomija": { emoji:"üçΩÔ∏è", color:"#24301f" },
    "Proizvodi":    { emoji:"üçØ", color:"#2a2431" }
  };

  function makeMarker(f){
    const p=f.properties||{}; const cat=CAT[p.kategorija]||{emoji:"üìç",color:"#1f2937"};
    const el=document.createElement('div');
    el.className='marker'; el.textContent=cat.emoji;
    el.style.cssText=`width:34px;height:34px;display:flex;align-items:center;justify-content:center;border-radius:12px;
      box-shadow:0 6px 14px rgba(0,0,0,.35);border:1px solid rgba(0,0,0,.35);background:${cat.color};color:#fff;font-size:18px;cursor:pointer`;
    return el;
  }
  const popup = new maplibregl.Popup({ closeButton:true, closeOnClick:true, anchor:"bottom" });
  function popupHTML(p){
    return `<div style="font:14px/1.5 system-ui,Arial,sans-serif;color:#e5e7eb;background:linear-gradient(180deg,rgba(31,41,55,.98),rgba(17,24,39,.98));border:1px solid rgba(255,255,255,.08);border-radius:14px;box-shadow:0 10px 25px rgba(0,0,0,.25);overflow:hidden;max-width:340px">
      <div style="display:flex;align-items:center;gap:.5rem;padding:.75rem .9rem .25rem .9rem">
        <h3 style="margin:0;font-size:16px;font-weight:700;letter-spacing:.2px">${p.naziv||""}</h3>
        <span style="margin-left:auto;font-size:12px;color:#0d151e;background:#a7f3d0;border-radius:999px;padding:.15rem .5rem;font-weight:600">${p.kategorija||""}</span>
      </div>
      <div style="padding:.25rem .9rem .9rem .9rem">
        ${p.opis?`<p style="margin:.35rem 0;color:#cbd5e1">${p.opis}</p>`:""}
        ${p.web?`<p style="margin:.35rem 0"><a style="color:#93c5fd;text-decoration:none;border-bottom:1px dashed rgba(147,197,253,.5)" href="${p.web}" target="_blank" rel="noopener">Web sajt ‚áó</a></p>`:""}
        ${p.foto?`<img src="${p.foto}" alt="${p.naziv||'Foto'}" style="width:100%;display:block;border-radius:12px;margin-top:.5rem">`:""}
      </div>
    </div>`;
  }

  map.on('load', ()=>{
    data.features.forEach(f=>{
      const [lng,lat]=f.geometry.coordinates;
      const el=makeMarker(f);
      el.addEventListener('click', ()=> popup.setLngLat([lng,lat]).setHTML(popupHTML(f.properties)).addTo(map) );
      new maplibregl.Marker({element:el,anchor:'bottom'}).setLngLat([lng,lat]).addTo(map);
    });
  });

  document.getElementById('share').addEventListener('click', (e)=>{
    e.preventDefault();
    const c=map.getCenter(); const z=map.getZoom().toFixed(2);
    const u=new URL(location.href); u.searchParams.set('lat', c.lat.toFixed(5)); u.searchParams.set('lng', c.lng.toFixed(5)); u.searchParams.set('zoom', z);
    navigator.clipboard.writeText(u.toString()); alert('Link kopiran u clipboard.');
  });

  <script>
  // ... postojeƒái kod i const map = new maplibregl.Map(...)

  function popupHTML(p){
    return `<div style="font:14px/1.5 system-ui,Arial">${p.naziv||""}<br>${p.opis||""}${p.web?`<br><a href="${p.web}" target="_blank" rel="noopener">Web sajt ‚áó</a>`:""}</div>`;
  }

  map.on('load', async () => {
    // 1) Uƒçitaj GeoJSON sa servera
    const resp = await fetch('data/places.geojson', {cache:'no-store'});
    const data = await resp.json();

    // 2) Dodaj izvor i slojeve (taƒçka + etiketa)
    map.addSource('places', { type:'geojson', data });

    map.addLayer({
      id:'places-circles',
      type:'circle',
      source:'places',
      paint:{
        'circle-radius': 6,
        'circle-color': ['match',['get','kategorija'],
          'Vina', '#7c3aed',
          'Gastronomija', '#059669',
          'Proizvodi', '#f59e0b',
          '#1f2937'
        ],
        'circle-stroke-width': 1,
        'circle-stroke-color': '#ffffff'
      }
    });

    map.addLayer({
      id:'places-labels',
      type:'symbol',
      source:'places',
      layout:{
        'text-field':['get','naziv'],
        'text-size':12,
        'text-offset':[0,1.2],
        'text-anchor':'top'
      },
      paint:{ 'text-halo-color':'#fff','text-halo-width':1 }
    });

    // 3) Klik = popup
    const popup = new maplibregl.Popup({ closeButton:true, closeOnClick:true });
    map.on('click','places-circles',(e)=>{
      const f = e.features[0]; const p = f.properties;
      popup.setLngLat(e.lngLat).setHTML(popupHTML(p)).addTo(map);
    });
    map.on('mouseenter','places-circles',()=>map.getCanvas().style.cursor='pointer');
    map.on('mouseleave','places-circles',()=>map.getCanvas().style.cursor='');
  });
</script>
</script
</script>
</body>
</html>
